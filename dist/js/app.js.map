{"version":3,"sources":["app/app.js","app/config/config-firebase.js","app/config/config-routes.js","app/index.html","app/modules/home/home-controller.js","app/modules/home/home.html","app/modules/home/index.js","app/modules/index.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAlGA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AATA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AAHA;AAAA;ACAA;AAAA;AAAA;AAAA;CCAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA1TA;AAAA;ACAA;AAAA;AAAA;AAAA;CCAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAbA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AALA;AAAA","file":"public/js/app.js","sourcesContent":["'use strict';\n\nvar _fastclick = require('fastclick');\n\nvar _fastclick2 = _interopRequireDefault(_fastclick);\n\nvar _angular = require('angular');\n\nvar _angular2 = _interopRequireDefault(_angular);\n\nrequire('angular-base-apps');\n\nrequire('angular-google-chart/ng-google-chart');\n\nrequire('angular-ui-router');\n\nvar _firebase = require('firebase');\n\nvar firebase = _interopRequireWildcard(_firebase);\n\nrequire('angularfire');\n\nvar _configFirebase = require('./config/config-firebase');\n\nvar _configFirebase2 = _interopRequireDefault(_configFirebase);\n\nrequire('angular-icons/dist/open-iconic');\n\nrequire('angular-icons/dist/ionicons');\n\nrequire('angular-icons/dist/material-icons');\n\nrequire('angular-dynamic-routing/dynamicRouting');\n\nrequire('angular-dynamic-routing/dynamicRouting.animations');\n\nvar _configRoutes = require('./config/config-routes');\n\nvar _configRoutes2 = _interopRequireDefault(_configRoutes);\n\nvar _modules = require('./modules');\n\nvar _modules2 = _interopRequireDefault(_modules);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n// Angular Base Apps Configuration\nfirebase.initializeApp(_configFirebase2.default);\n\n// Icon Configuration\n\n\n// Firebase Configuration\n\n\n// Route Configuration\n\n\n// Application Configuration\n\n\nvar AppConfig = function AppConfig($urlProvider, $locationProvider, $firebaseRefProvider, $BaseAppsStateProvider) {\n  $urlProvider.otherwise('/');\n\n  $locationProvider.html5Mode({\n    enabled: true,\n    requireBase: false\n  });\n\n  $firebaseRefProvider.registerUrl(_configFirebase2.default.databaseURL);\n\n  $BaseAppsStateProvider.registerDynamicRoutes(_configRoutes2.default);\n};\n\nAppConfig.$inject = ['$urlRouterProvider', '$locationProvider', '$firebaseRefProvider', '$BaseAppsStateProvider'];\n\nvar AppRun = function AppRun() {\n  _fastclick2.default.FastClick.attach(document.body);\n};\n\n_angular2.default.module('application', ['ui.router', 'ngAnimate',\n\n// firebase\n'firebase',\n\n// base apps\n'base',\n\n// google charts\n'googlechart',\n\n// icons\n'angularIcons.openIconic', 'angularIcons.ionicons', 'angularIcons.materialIcons',\n\n// dynamic routing\n'dynamicRouting', 'dynamicRouting.animations'].concat(_modules2.default)).config(AppConfig).run(AppRun);\n","'use strict';\n\nmodule.exports = {\n  apiKey: 'AIzaSyBY48PLnCREEFM9h7m7E0YwuhuBlbPuuXU',\n  authDomain: 'fir-reporting-angular.firebaseapp.com',\n  databaseURL: 'https://fir-reporting-angular.firebaseio.com',\n  storageBucket: 'fir-reporting-angular.appspot.com',\n  messagingSenderId: '1063292915498'\n};\n","\"use strict\";\n\nmodule.exports = [{ \"name\": \"home\", \"url\": \"/\", \"controller\": \"HomeController as home\", \"path\": \"modules/home/home.html\" }];\n","","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _firebaseReporting = require('@greenhousegames/firebase-reporting');\n\nvar _firebaseReporting2 = _interopRequireDefault(_firebaseReporting);\n\nvar _firebase = require('firebase');\n\nvar _firebase2 = _interopRequireDefault(_firebase);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar HomeController = function () {\n  function HomeController($firebaseRef, $firebaseAuth, $firebaseArray, $timeout, $q) {\n    var _this = this;\n\n    _classCallCheck(this, HomeController);\n\n    this.authService = $firebaseAuth(_firebase2.default.auth());\n    this.$timeout = $timeout;\n    this.$q = $q;\n    this.authLoaded = false;\n    this.totalClicks = null;\n    this.totalUsers = null;\n    this.lastClicked = null;\n    this.data = $firebaseArray($firebaseRef.default.child('data'));\n    this.reportingService = new _firebaseReporting2.default({\n      firebase: $firebaseRef.default.child('reporting')\n    });\n\n    this.authService.$requireSignIn().then(function () {\n      return _this.init();\n    }).catch(function () {\n      return _this.authService.$signInAnonymously().then(function () {\n        return _this.init();\n      });\n    });\n\n    this.piechart = {\n      type: 'PieChart',\n      data: {\n        'cols': [{ label: 'Button', type: 'string' }, { label: 'Times Clicked', type: 'number' }],\n        'rows': []\n      },\n      options: {\n        legend: {\n          position: 'bottom'\n        }\n      }\n    };\n    this.linecharts = {};\n    this.linecharts.minute = {\n      type: 'LineChart',\n      data: {\n        'cols': [{ label: 'Time', type: 'date' }, { label: 'A', type: 'number' }, { label: 'B', type: 'number' }, { label: 'C', type: 'number' }, { label: 'D', type: 'number' }],\n        'rows': []\n      },\n      options: {\n        title: 'Clicked this Hour',\n        legend: {\n          position: 'bottom'\n        }\n      }\n    };\n    this.linecharts.hour = {\n      type: 'LineChart',\n      data: {\n        'cols': [{ label: 'Time', type: 'date' }, { label: 'A', type: 'number' }, { label: 'B', type: 'number' }, { label: 'C', type: 'number' }, { label: 'D', type: 'number' }],\n        'rows': []\n      },\n      options: {\n        title: 'Clicked Today',\n        legend: {\n          position: 'bottom'\n        }\n      }\n    };\n    this.linecharts.day = {\n      type: 'LineChart',\n      data: {\n        'cols': [{ label: 'Time', type: 'date' }, { label: 'A', type: 'number' }, { label: 'B', type: 'number' }, { label: 'C', type: 'number' }, { label: 'D', type: 'number' }],\n        'rows': []\n      },\n      options: {\n        title: 'Clicked this Month',\n        legend: {\n          position: 'bottom'\n        }\n      }\n    };\n    this.linecharts.week = {\n      type: 'LineChart',\n      data: {\n        'cols': [{ label: 'Time', type: 'date' }, { label: 'A', type: 'number' }, { label: 'B', type: 'number' }, { label: 'C', type: 'number' }, { label: 'D', type: 'number' }],\n        'rows': []\n      },\n      options: {\n        title: 'Clicked this Year',\n        legend: {\n          position: 'bottom'\n        }\n      }\n    };\n\n    return this;\n  }\n\n  _createClass(HomeController, [{\n    key: 'init',\n    value: function init() {\n      var _this2 = this;\n\n      this.authLoaded = true;\n      this.initReportingService();\n      this.data.$watch(function () {\n        return _this2.drawAll();\n      });\n      this.drawAll();\n    }\n  }, {\n    key: 'buttonClicked',\n    value: function buttonClicked(button) {\n      var _this3 = this;\n\n      var data = {\n        uid: this.authService.$getAuth().uid,\n        timestamp: _firebase2.default.database.ServerValue.TIMESTAMP,\n        anyclicked: 1\n      };\n      data[button + 'clicked'] = 1;\n\n      // save metrics first to ensure onDataSaved callback\n      // is called after metrics have been calculated\n      this.reportingService.saveMetrics(data).then(function () {\n        _this3.data.$add(data);\n      });\n    }\n  }, {\n    key: 'drawAll',\n    value: function drawAll() {\n      this.drawMetrics();\n      this.drawCharts();\n    }\n  }, {\n    key: 'drawMetrics',\n    value: function drawMetrics() {\n      var _this4 = this;\n\n      this.reportingService.filter().sum('anyclicked').select(1).then(function (values) {\n        _this4.$timeout(function () {\n          return _this4.totalClicks = values[0] || 0;\n        });\n      });\n      this.reportingService.filter('users').sum('anyclicked').count().then(function (value) {\n        _this4.$timeout(function () {\n          return _this4.totalUsers = value || 0;\n        });\n      });\n      this.reportingService.filter().last('timestamp').select(1).then(function (values) {\n        _this4.$timeout(function () {\n          return _this4.lastClicked = values[0] || null;\n        });\n      });\n    }\n  }, {\n    key: 'drawCharts',\n    value: function drawCharts() {\n      this.drawPieChart();\n      this.drawLineChart('minute');\n      this.drawLineChart('hour');\n      this.drawLineChart('day');\n      this.drawLineChart('week');\n    }\n  }, {\n    key: 'drawPieChart',\n    value: function drawPieChart() {\n      var _this5 = this;\n\n      var aClickedQuery = this.reportingService.filter().sum('aclicked').value();\n      var bClickedQuery = this.reportingService.filter().sum('bclicked').value();\n      var cClickedQuery = this.reportingService.filter().sum('cclicked').value();\n      var dClickedQuery = this.reportingService.filter().sum('dclicked').value();\n\n      this.$q.all([aClickedQuery, bClickedQuery, cClickedQuery, dClickedQuery]).then(function (values) {\n        _this5.$timeout(function () {\n          _this5.piechart.data.rows.splice(0, _this5.piechart.data.rows.length);\n          _this5.piechart.data.rows.push({ c: [{ v: 'A' }, { v: values[0] }] });\n          _this5.piechart.data.rows.push({ c: [{ v: 'B' }, { v: values[1] }] });\n          _this5.piechart.data.rows.push({ c: [{ v: 'C' }, { v: values[2] }] });\n          _this5.piechart.data.rows.push({ c: [{ v: 'D' }, { v: values[3] }] });\n        });\n      });\n    }\n  }, {\n    key: 'drawLineChart',\n    value: function drawLineChart(during) {\n      var _this6 = this;\n\n      var queryStartTime = new Date();\n      var queryEndTime = new Date();\n      queryStartTime.setMilliseconds(0);\n      queryStartTime.setSeconds(0);\n      queryStartTime.setMinutes(0);\n\n      switch (during) {\n        case 'minute':\n          queryEndTime.setTime(queryStartTime.getTime());\n          queryEndTime.setHours(queryStartTime.getHours() + 1);\n          break;\n        case 'hour':\n          queryStartTime.setHours(0);\n          queryEndTime.setTime(queryStartTime.getTime());\n          queryEndTime.setDate(queryStartTime.getDate() + 1);\n          break;\n        case 'day':\n          queryStartTime.setHours(0);\n          queryStartTime.setDate(1);\n          queryEndTime.setTime(queryStartTime.getTime());\n          queryEndTime.setMonth(queryStartTime.getMonth() + 1);\n          break;\n        case 'week':\n          queryStartTime.setHours(0);\n          queryStartTime.setDate(1);\n          queryStartTime.setMonth(1);\n          queryEndTime.setTime(queryStartTime.getTime());\n          queryEndTime.setFullYear(queryStartTime.getFullYear() + 1);\n          break;\n      }\n\n      var aClickedQuery = this.reportingService.filter().sum('aclicked').during(during).range(queryStartTime.getTime(), queryEndTime.getTime()).values(true);\n      var bClickedQuery = this.reportingService.filter().sum('bclicked').during(during).range(queryStartTime.getTime(), queryEndTime.getTime()).values(true);\n      var cClickedQuery = this.reportingService.filter().sum('cclicked').during(during).range(queryStartTime.getTime(), queryEndTime.getTime()).values(true);\n      var dClickedQuery = this.reportingService.filter().sum('dclicked').during(during).range(queryStartTime.getTime(), queryEndTime.getTime()).values(true);\n\n      this.$q.all([aClickedQuery, bClickedQuery, cClickedQuery, dClickedQuery]).then(function (values) {\n        _this6.linecharts[during].data.rows.splice(0, _this6.linecharts[during].data.rows.length);\n        for (var i = 0; i < values[0].length; i++) {\n          _this6.linecharts[during].data.rows.push({\n            c: [{\n              v: new Date(values[0][i].timestamp)\n            }, {\n              v: values[0][i].value\n            }, {\n              v: values[1][i].value\n            }, {\n              v: values[2][i].value\n            }, {\n              v: values[3][i].value\n            }]\n          });\n        }\n      });\n    }\n  }, {\n    key: 'initReportingService',\n    value: function initReportingService() {\n      // Add report filter for users\n      this.reportingService.addFilter('users', ['uid']);\n\n      // Metrics for timing\n      this.reportingService.addMetric('timestamp', ['first', 'last']);\n\n      // Metrics for ANY button clicked\n      this.reportingService.addMetric('anyclicked', ['sum']);\n      this.reportingService.enableRetainer('minute', 'anyclicked', ['sum']);\n      this.reportingService.enableRetainer('hour', 'anyclicked', ['sum']);\n      this.reportingService.enableRetainer('day', 'anyclicked', ['sum']);\n      this.reportingService.enableRetainer('week', 'anyclicked', ['sum']);\n\n      // Metrics for A button clicked\n      this.reportingService.addMetric('aclicked', ['sum']);\n      this.reportingService.enableRetainer('minute', 'aclicked', ['sum']);\n      this.reportingService.enableRetainer('hour', 'aclicked', ['sum']);\n      this.reportingService.enableRetainer('day', 'aclicked', ['sum']);\n      this.reportingService.enableRetainer('week', 'aclicked', ['sum']);\n\n      // Metrics for B button clicked\n      this.reportingService.addMetric('bclicked', ['sum']);\n      this.reportingService.enableRetainer('minute', 'bclicked', ['sum']);\n      this.reportingService.enableRetainer('hour', 'bclicked', ['sum']);\n      this.reportingService.enableRetainer('day', 'bclicked', ['sum']);\n      this.reportingService.enableRetainer('week', 'bclicked', ['sum']);\n\n      // Metrics for C button clicked\n      this.reportingService.addMetric('cclicked', ['sum']);\n      this.reportingService.enableRetainer('minute', 'cclicked', ['sum']);\n      this.reportingService.enableRetainer('hour', 'cclicked', ['sum']);\n      this.reportingService.enableRetainer('day', 'cclicked', ['sum']);\n      this.reportingService.enableRetainer('week', 'cclicked', ['sum']);\n\n      // Metrics for D button clicked\n      this.reportingService.addMetric('dclicked', ['sum']);\n      this.reportingService.enableRetainer('minute', 'dclicked', ['sum']);\n      this.reportingService.enableRetainer('hour', 'dclicked', ['sum']);\n      this.reportingService.enableRetainer('day', 'dclicked', ['sum']);\n      this.reportingService.enableRetainer('week', 'dclicked', ['sum']);\n    }\n  }]);\n\n  return HomeController;\n}();\n\nexports.default = HomeController;\n\n\nHomeController.$inject = ['$firebaseRef', '$firebaseAuth', '$firebaseArray', '$timeout', '$q'];\n","","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _homeController = require('./home-controller');\n\nvar _homeController2 = _interopRequireDefault(_homeController);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nexports.default = angular.module('application.home', ['firebase.database']).controller('HomeController', _homeController2.default).name;\n","'use strict';\n\nrequire('./home');\n\nmodule.exports = ['application.home'];\n"]}